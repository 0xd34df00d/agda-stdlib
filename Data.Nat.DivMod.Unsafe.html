<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Data.Nat.DivMod.Unsafe</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- More efficient (and unsafe) mod and divMod operations</a>
<a id="163" class="Comment">------------------------------------------------------------------------</a>

<a id="237" class="Symbol">{-#</a> <a id="241" class="Keyword">OPTIONS</a> <a id="249" class="Option">--with-K</a> <a id="258" class="Symbol">#-}</a>

<a id="263" class="Keyword">module</a> <a id="270" href="Data.Nat.DivMod.Unsafe.html" class="Module">Data.Nat.DivMod.Unsafe</a> <a id="293" class="Keyword">where</a>

<a id="300" class="Keyword">open</a> <a id="305" class="Keyword">import</a> <a id="312" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="321" class="Keyword">using</a> <a id="327" class="Symbol">(</a><a id="328" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="329" class="Symbol">;</a> <a id="331" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">_+_</a><a id="334" class="Symbol">;</a> <a id="336" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">_*_</a><a id="339" class="Symbol">;</a> <a id="341" href="Data.Nat.Properties.html#2153" class="Function Operator">_≟_</a><a id="344" class="Symbol">;</a> <a id="346" href="Agda.Builtin.Nat.html#115" class="InductiveConstructor">zero</a><a id="350" class="Symbol">;</a> <a id="352" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a><a id="355" class="Symbol">)</a>
<a id="357" class="Keyword">open</a> <a id="362" class="Keyword">import</a> <a id="369" href="Data.Nat.DivMod.html" class="Module">Data.Nat.DivMod</a> <a id="385" class="Keyword">hiding</a> <a id="392" class="Symbol">(</a><a id="393" href="Data.Nat.DivMod.html#3244" class="Function Operator">_mod_</a><a id="398" class="Symbol">;</a> <a id="400" href="Data.Nat.DivMod.html#3365" class="Function Operator">_divMod_</a><a id="408" class="Symbol">)</a>
<a id="410" class="Keyword">open</a> <a id="415" class="Keyword">import</a> <a id="422" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="442" class="Keyword">using</a> <a id="448" class="Symbol">(</a><a id="449" href="Data.Nat.Properties.html#43614" class="Function">≤⇒≤″</a><a id="453" class="Symbol">)</a>
<a id="455" class="Keyword">import</a> <a id="462" href="Data.Nat.Unsafe.html" class="Module">Data.Nat.Unsafe</a> <a id="478" class="Symbol">as</a> <a id="481" class="Module">NatUnsafe</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="512" class="Keyword">using</a> <a id="518" class="Symbol">(</a><a id="519" href="Data.Fin.Base.html#951" class="Datatype">Fin</a><a id="522" class="Symbol">;</a> <a id="524" href="Data.Fin.Base.html#1077" class="Function">toℕ</a><a id="527" class="Symbol">;</a> <a id="529" href="Data.Fin.Base.html#1983" class="Function">fromℕ≤″</a><a id="536" class="Symbol">)</a>
<a id="538" class="Keyword">open</a> <a id="543" class="Keyword">import</a> <a id="550" href="Data.Fin.Properties.html" class="Module">Data.Fin.Properties</a> <a id="570" class="Keyword">using</a> <a id="576" class="Symbol">(</a><a id="577" href="Data.Fin.Properties.html#4891" class="Function">toℕ-fromℕ≤″</a><a id="588" class="Symbol">)</a>
<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Function.html" class="Module">Function</a> <a id="611" class="Keyword">using</a> <a id="617" class="Symbol">(</a><a id="618" href="Function.html#1927" class="Function Operator">_$_</a><a id="621" class="Symbol">)</a>
<a id="623" class="Keyword">open</a> <a id="628" class="Keyword">import</a> <a id="635" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="662" class="Keyword">using</a> <a id="668" class="Symbol">(</a><a id="669" href="Relation.Nullary.Decidable.html#990" class="Function">False</a><a id="674" class="Symbol">)</a>
<a id="676" class="Keyword">open</a> <a id="681" class="Keyword">import</a> <a id="688" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="728" class="Keyword">using</a> <a id="734" class="Symbol">(</a><a id="735" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="739" class="Symbol">;</a> <a id="741" href="Relation.Binary.PropositionalEquality.Core.html#874" class="Function">sym</a><a id="744" class="Symbol">;</a> <a id="746" href="Relation.Binary.PropositionalEquality.Core.html#1045" class="Function">cong</a><a id="750" class="Symbol">;</a> <a id="752" class="Keyword">module</a> <a id="759" href="Relation.Binary.PropositionalEquality.Core.html#2366" class="Module">≡-Reasoning</a><a id="770" class="Symbol">)</a>
<a id="772" class="Keyword">import</a> <a id="779" href="Relation.Binary.PropositionalEquality.TrustMe.html" class="Module">Relation.Binary.PropositionalEquality.TrustMe</a> <a id="825" class="Symbol">as</a> <a id="828" class="Module">TrustMe</a>
  <a id="838" class="Keyword">using</a> <a id="844" class="Symbol">(</a><a id="845" href="Relation.Binary.PropositionalEquality.TrustMe.html#844" class="Function">erase</a><a id="850" class="Symbol">)</a>

<a id="853" class="Keyword">open</a> <a id="858" href="Relation.Binary.PropositionalEquality.Core.html#2366" class="Module">≡-Reasoning</a>

<a id="871" class="Keyword">infixl</a> <a id="878" class="Number">7</a> <a id="880" href="Data.Nat.DivMod.Unsafe.html#991" class="Function Operator">_mod_</a> <a id="886" href="Data.Nat.DivMod.Unsafe.html#1286" class="Function Operator">_divMod_</a>

<a id="896" class="Comment">------------------------------------------------------------------------</a>
<a id="969" class="Comment">-- Certified modulus</a>

<a id="_mod_"></a><a id="991" href="Data.Nat.DivMod.Unsafe.html#991" class="Function Operator">_mod_</a> <a id="997" class="Symbol">:</a> <a id="999" class="Symbol">(</a><a id="1000" href="Data.Nat.DivMod.Unsafe.html#1000" class="Bound">dividend</a> <a id="1009" href="Data.Nat.DivMod.Unsafe.html#1009" class="Bound">divisor</a> <a id="1017" class="Symbol">:</a> <a id="1019" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="1020" class="Symbol">)</a> <a id="1022" class="Symbol">{</a><a id="1023" href="Data.Nat.DivMod.Unsafe.html#1023" class="Bound">≢0</a> <a id="1026" class="Symbol">:</a> <a id="1028" href="Relation.Nullary.Decidable.html#990" class="Function">False</a> <a id="1034" class="Symbol">(</a><a id="1035" href="Data.Nat.DivMod.Unsafe.html#1009" class="Bound">divisor</a> <a id="1043" href="Data.Nat.Properties.html#2153" class="Function Operator">≟</a> <a id="1045" class="Number">0</a><a id="1046" class="Symbol">)}</a> <a id="1049" class="Symbol">→</a> <a id="1051" href="Data.Fin.Base.html#951" class="Datatype">Fin</a> <a id="1055" href="Data.Nat.DivMod.Unsafe.html#1009" class="Bound">divisor</a>
<a id="1063" class="Symbol">(</a><a id="1064" href="Data.Nat.DivMod.Unsafe.html#1064" class="Bound">a</a> <a id="1066" href="Data.Nat.DivMod.Unsafe.html#991" class="Function Operator">mod</a> <a id="1070" class="Number">0</a><a id="1071" class="Symbol">)</a> <a id="1073" class="Symbol">{}</a>
<a id="1076" class="Symbol">(</a><a id="1077" href="Data.Nat.DivMod.Unsafe.html#1077" class="Bound">a</a> <a id="1079" href="Data.Nat.DivMod.Unsafe.html#991" class="Function Operator">mod</a> <a id="1083" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1087" href="Data.Nat.DivMod.Unsafe.html#1087" class="Bound">n</a><a id="1088" class="Symbol">)</a> <a id="1090" class="Symbol">=</a> <a id="1092" href="Data.Fin.Base.html#1983" class="Function">fromℕ≤″</a> <a id="1100" class="Symbol">(</a><a id="1101" href="Data.Nat.DivMod.Unsafe.html#1077" class="Bound">a</a> <a id="1103" href="Data.Nat.DivMod.html#996" class="Function Operator">%</a> <a id="1105" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1109" href="Data.Nat.DivMod.Unsafe.html#1087" class="Bound">n</a><a id="1110" class="Symbol">)</a> <a id="1112" class="Symbol">(</a><a id="1113" href="Data.Nat.Unsafe.html#373" class="Function">NatUnsafe.erase</a> <a id="1129" class="Symbol">(</a><a id="1130" href="Data.Nat.Properties.html#43614" class="Function">≤⇒≤″</a> <a id="1135" class="Symbol">(</a><a id="1136" href="Data.Nat.DivMod.html#1341" class="Function">a%n&lt;n</a> <a id="1142" href="Data.Nat.DivMod.Unsafe.html#1077" class="Bound">a</a> <a id="1144" href="Data.Nat.DivMod.Unsafe.html#1087" class="Bound">n</a><a id="1145" class="Symbol">)))</a>

<a id="1150" class="Comment">------------------------------------------------------------------------</a>
<a id="1223" class="Comment">-- Returns modulus and division result with correctness proof</a>

<a id="_divMod_"></a><a id="1286" href="Data.Nat.DivMod.Unsafe.html#1286" class="Function Operator">_divMod_</a> <a id="1295" class="Symbol">:</a> <a id="1297" class="Symbol">(</a><a id="1298" href="Data.Nat.DivMod.Unsafe.html#1298" class="Bound">dividend</a> <a id="1307" href="Data.Nat.DivMod.Unsafe.html#1307" class="Bound">divisor</a> <a id="1315" class="Symbol">:</a> <a id="1317" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="1318" class="Symbol">)</a> <a id="1320" class="Symbol">{</a><a id="1321" href="Data.Nat.DivMod.Unsafe.html#1321" class="Bound">≢0</a> <a id="1324" class="Symbol">:</a> <a id="1326" href="Relation.Nullary.Decidable.html#990" class="Function">False</a> <a id="1332" class="Symbol">(</a><a id="1333" href="Data.Nat.DivMod.Unsafe.html#1307" class="Bound">divisor</a> <a id="1341" href="Data.Nat.Properties.html#2153" class="Function Operator">≟</a> <a id="1343" class="Number">0</a><a id="1344" class="Symbol">)}</a> <a id="1347" class="Symbol">→</a>
           <a id="1360" href="Data.Nat.DivMod.html#3064" class="Record">DivMod</a> <a id="1367" href="Data.Nat.DivMod.Unsafe.html#1298" class="Bound">dividend</a> <a id="1376" href="Data.Nat.DivMod.Unsafe.html#1307" class="Bound">divisor</a>
<a id="1384" class="Symbol">(</a><a id="1385" href="Data.Nat.DivMod.Unsafe.html#1385" class="Bound">a</a> <a id="1387" href="Data.Nat.DivMod.Unsafe.html#1286" class="Function Operator">divMod</a> <a id="1394" class="Number">0</a><a id="1395" class="Symbol">)</a> <a id="1397" class="Symbol">{}</a>
<a id="1400" class="Symbol">(</a><a id="1401" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1403" href="Data.Nat.DivMod.Unsafe.html#1286" class="Function Operator">divMod</a> <a id="1410" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1414" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a><a id="1415" class="Symbol">)</a> <a id="1417" class="Symbol">=</a> <a id="1419" href="Data.Nat.DivMod.html#3120" class="InductiveConstructor">result</a> <a id="1426" class="Symbol">(</a><a id="1427" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1429" href="Data.Nat.DivMod.html#857" class="Function Operator">div</a> <a id="1433" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1437" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a><a id="1438" class="Symbol">)</a> <a id="1440" class="Symbol">(</a><a id="1441" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1443" href="Data.Nat.DivMod.Unsafe.html#991" class="Function Operator">mod</a> <a id="1447" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1451" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a><a id="1452" class="Symbol">)</a> <a id="1454" href="Function.html#1927" class="Function Operator">$</a> <a id="1456" href="Relation.Binary.PropositionalEquality.TrustMe.html#844" class="Function">TrustMe.erase</a> <a id="1470" href="Function.html#1927" class="Function Operator">$</a> <a id="1472" href="Relation.Binary.PropositionalEquality.Core.html#2460" class="Function Operator">begin</a>
  <a id="1480" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a>                                 <a id="1514" href="Relation.Binary.PropositionalEquality.Core.html#2577" class="Function Operator">≡⟨</a> <a id="1517" href="Data.Nat.DivMod.html#1189" class="Function">a≡a%n+[a/n]*n</a> <a id="1531" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1533" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a> <a id="1535" href="Relation.Binary.PropositionalEquality.Core.html#2577" class="Function Operator">⟩</a>
  <a id="1539" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1541" href="Data.Nat.DivMod.html#996" class="Function Operator">%</a> <a id="1543" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1547" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a>              <a id="1562" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="1564" href="Data.Nat.DivMod.Unsafe.html#1717" class="Function">[a/n]*n</a>  <a id="1573" href="Relation.Binary.PropositionalEquality.Core.html#2577" class="Function Operator">≡⟨</a> <a id="1576" href="Relation.Binary.PropositionalEquality.Core.html#1045" class="Function">cong</a> <a id="1581" class="Symbol">(</a><a id="1582" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">_+</a> <a id="1585" href="Data.Nat.DivMod.Unsafe.html#1717" class="Function">[a/n]*n</a><a id="1592" class="Symbol">)</a> <a id="1594" class="Symbol">(</a><a id="1595" href="Relation.Binary.PropositionalEquality.Core.html#874" class="Function">sym</a> <a id="1599" class="Symbol">(</a><a id="1600" href="Data.Fin.Properties.html#4891" class="Function">toℕ-fromℕ≤″</a> <a id="1612" href="Data.Nat.DivMod.Unsafe.html#1671" class="Function">lemma′</a><a id="1618" class="Symbol">))</a> <a id="1621" href="Relation.Binary.PropositionalEquality.Core.html#2577" class="Function Operator">⟩</a>
  <a id="1625" href="Data.Fin.Base.html#1077" class="Function">toℕ</a> <a id="1629" class="Symbol">(</a><a id="1630" href="Data.Fin.Base.html#1983" class="Function">fromℕ≤″</a> <a id="1638" class="Symbol">_</a> <a id="1640" href="Data.Nat.DivMod.Unsafe.html#1671" class="Function">lemma′</a><a id="1646" class="Symbol">)</a> <a id="1648" href="Agda.Builtin.Nat.html#230" class="Primitive Operator">+</a> <a id="1650" href="Data.Nat.DivMod.Unsafe.html#1717" class="Function">[a/n]*n</a>  <a id="1659" href="Relation.Binary.PropositionalEquality.Core.html#2662" class="Function Operator">∎</a>
  <a id="1663" class="Keyword">where</a>
  <a id="1671" href="Data.Nat.DivMod.Unsafe.html#1671" class="Function">lemma′</a> <a id="1678" class="Symbol">=</a> <a id="1680" href="Data.Nat.Unsafe.html#373" class="Function">NatUnsafe.erase</a> <a id="1696" class="Symbol">(</a><a id="1697" href="Data.Nat.Properties.html#43614" class="Function">≤⇒≤″</a> <a id="1702" class="Symbol">(</a><a id="1703" href="Data.Nat.DivMod.html#1341" class="Function">a%n&lt;n</a> <a id="1709" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1711" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a><a id="1712" class="Symbol">))</a>
  <a id="1717" href="Data.Nat.DivMod.Unsafe.html#1717" class="Function">[a/n]*n</a> <a id="1725" class="Symbol">=</a> <a id="1727" href="Data.Nat.DivMod.Unsafe.html#1401" class="Bound">a</a> <a id="1729" href="Data.Nat.DivMod.html#857" class="Function Operator">div</a> <a id="1733" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1737" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a> <a id="1739" href="Agda.Builtin.Nat.html#433" class="Primitive Operator">*</a> <a id="1741" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1745" href="Data.Nat.DivMod.Unsafe.html#1414" class="Bound">n</a>
</pre></body></html>