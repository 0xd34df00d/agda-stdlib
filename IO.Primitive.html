<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>IO.Primitive</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Primitive IO: simple bindings to Haskell types and functions</a>
<a id="170" class="Comment">------------------------------------------------------------------------</a>

<a id="244" class="Keyword">module</a> <a id="251" href="IO.Primitive.html" class="Module">IO.Primitive</a> <a id="264" class="Keyword">where</a>

<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Codata.Musical.Costring.html" class="Module">Codata.Musical.Costring</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Char.Base.html" class="Module">Data.Char.Base</a>
<a id="334" class="Keyword">open</a> <a id="339" class="Keyword">import</a> <a id="346" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="363" class="Keyword">open</a> <a id="368" class="Keyword">import</a> <a id="375" href="Foreign.Haskell.html" class="Module">Foreign.Haskell</a>

<a id="392" class="Comment">------------------------------------------------------------------------</a>
<a id="465" class="Comment">-- The IO monad</a>

<a id="482" class="Keyword">open</a> <a id="487" class="Keyword">import</a> <a id="494" href="Agda.Builtin.IO.html" class="Module">Agda.Builtin.IO</a> <a id="510" class="Keyword">public</a> <a id="517" class="Keyword">using</a> <a id="523" class="Symbol">(</a><a id="524" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a><a id="526" class="Symbol">)</a>

<a id="529" class="Keyword">infixl</a> <a id="536" class="Number">1</a> <a id="538" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>

<a id="545" class="Keyword">postulate</a>
  <a id="return"></a><a id="557" href="IO.Primitive.html#557" class="Postulate">return</a> <a id="564" class="Symbol">:</a> <a id="566" class="Symbol">∀</a> <a id="568" class="Symbol">{</a><a id="569" href="IO.Primitive.html#569" class="Bound">a</a><a id="570" class="Symbol">}</a> <a id="572" class="Symbol">{</a><a id="573" href="IO.Primitive.html#573" class="Bound">A</a> <a id="575" class="Symbol">:</a> <a id="577" class="PrimitiveType">Set</a> <a id="581" href="IO.Primitive.html#569" class="Bound">a</a><a id="582" class="Symbol">}</a> <a id="584" class="Symbol">→</a> <a id="586" href="IO.Primitive.html#573" class="Bound">A</a> <a id="588" class="Symbol">→</a> <a id="590" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="593" href="IO.Primitive.html#573" class="Bound">A</a>
  <a id="_&gt;&gt;=_"></a><a id="597" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="604" class="Symbol">:</a> <a id="606" class="Symbol">∀</a> <a id="608" class="Symbol">{</a><a id="609" href="IO.Primitive.html#609" class="Bound">a</a> <a id="611" href="IO.Primitive.html#611" class="Bound">b</a><a id="612" class="Symbol">}</a> <a id="614" class="Symbol">{</a><a id="615" href="IO.Primitive.html#615" class="Bound">A</a> <a id="617" class="Symbol">:</a> <a id="619" class="PrimitiveType">Set</a> <a id="623" href="IO.Primitive.html#609" class="Bound">a</a><a id="624" class="Symbol">}</a> <a id="626" class="Symbol">{</a><a id="627" href="IO.Primitive.html#627" class="Bound">B</a> <a id="629" class="Symbol">:</a> <a id="631" class="PrimitiveType">Set</a> <a id="635" href="IO.Primitive.html#611" class="Bound">b</a><a id="636" class="Symbol">}</a> <a id="638" class="Symbol">→</a> <a id="640" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="643" href="IO.Primitive.html#615" class="Bound">A</a> <a id="645" class="Symbol">→</a> <a id="647" class="Symbol">(</a><a id="648" href="IO.Primitive.html#615" class="Bound">A</a> <a id="650" class="Symbol">→</a> <a id="652" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="655" href="IO.Primitive.html#627" class="Bound">B</a><a id="656" class="Symbol">)</a> <a id="658" class="Symbol">→</a> <a id="660" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="663" href="IO.Primitive.html#627" class="Bound">B</a>

<a id="666" class="Symbol">{-#</a> <a id="670" class="Keyword">COMPILE</a> GHC <a id="682" href="IO.Primitive.html#557" class="Postulate">return</a> = \_ _ -&gt; return    <a id="709" class="Symbol">#-}</a>
<a id="713" class="Symbol">{-#</a> <a id="717" class="Keyword">COMPILE</a> GHC <a id="729" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>  = \_ _ _ _ -&gt; (&gt;&gt;=) <a id="756" class="Symbol">#-}</a>
<a id="760" class="Symbol">{-#</a> <a id="764" class="Keyword">COMPILE</a> UHC <a id="776" href="IO.Primitive.html#557" class="Postulate">return</a> = \_ _ x -&gt; UHC.Agda.Builtins.primReturn x <a id="826" class="Symbol">#-}</a>
<a id="830" class="Symbol">{-#</a> <a id="834" class="Keyword">COMPILE</a> UHC <a id="846" href="IO.Primitive.html#597" class="Postulate Operator">_&gt;&gt;=_</a>  = \_ _ _ _ x y -&gt; UHC.Agda.Builtins.primBind x y <a id="902" class="Symbol">#-}</a>

<a id="907" class="Comment">------------------------------------------------------------------------</a>
<a id="980" class="Comment">-- Simple lazy IO</a>

<a id="999" class="Comment">-- Note that the functions below produce commands which, when</a>
<a id="1061" class="Comment">-- executed, may raise exceptions.</a>

<a id="1097" class="Comment">-- Note also that the semantics of these functions depends on the</a>
<a id="1163" class="Comment">-- version of the Haskell base library. If the version is 4.2.0.0 (or</a>
<a id="1233" class="Comment">-- later?), then the functions use the character encoding specified by</a>
<a id="1304" class="Comment">-- the locale. For older versions of the library (going back to at</a>
<a id="1371" class="Comment">-- least version 3) the functions use ISO-8859-1.</a>

<a id="1422" class="Symbol">{-#</a> <a id="1426" class="Keyword">FOREIGN</a> GHC import qualified Data.Text    <a id="1468" class="Symbol">#-}</a>
<a id="1472" class="Symbol">{-#</a> <a id="1476" class="Keyword">FOREIGN</a> GHC import qualified Data.Text.IO <a id="1518" class="Symbol">#-}</a>
<a id="1522" class="Symbol">{-#</a> <a id="1526" class="Keyword">FOREIGN</a> GHC import qualified System.IO    <a id="1568" class="Symbol">#-}</a>
<a id="1572" class="Symbol">{-#</a> <a id="1576" class="Keyword">FOREIGN</a> GHC import qualified Control.Exception <a id="1623" class="Symbol">#-}</a>

<a id="1628" class="Keyword">postulate</a>
  <a id="getContents"></a><a id="1640" href="IO.Primitive.html#1640" class="Postulate">getContents</a> <a id="1652" class="Symbol">:</a> <a id="1654" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1657" href="Codata.Musical.Costring.html#439" class="Function">Costring</a>
  <a id="readFile"></a><a id="1668" href="IO.Primitive.html#1668" class="Postulate">readFile</a>    <a id="1680" class="Symbol">:</a> <a id="1682" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1689" class="Symbol">→</a> <a id="1691" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1694" href="Codata.Musical.Costring.html#439" class="Function">Costring</a>
  <a id="writeFile"></a><a id="1705" href="IO.Primitive.html#1705" class="Postulate">writeFile</a>   <a id="1717" class="Symbol">:</a> <a id="1719" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1726" class="Symbol">→</a> <a id="1728" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1737" class="Symbol">→</a> <a id="1739" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1742" href="Foreign.Haskell.html#295" class="Datatype">Unit</a>
  <a id="appendFile"></a><a id="1749" href="IO.Primitive.html#1749" class="Postulate">appendFile</a>  <a id="1761" class="Symbol">:</a> <a id="1763" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1770" class="Symbol">→</a> <a id="1772" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1781" class="Symbol">→</a> <a id="1783" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1786" href="Foreign.Haskell.html#295" class="Datatype">Unit</a>
  <a id="putStr"></a><a id="1793" href="IO.Primitive.html#1793" class="Postulate">putStr</a>      <a id="1805" class="Symbol">:</a> <a id="1807" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1816" class="Symbol">→</a> <a id="1818" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1821" href="Foreign.Haskell.html#295" class="Datatype">Unit</a>
  <a id="putStrLn"></a><a id="1828" href="IO.Primitive.html#1828" class="Postulate">putStrLn</a>    <a id="1840" class="Symbol">:</a> <a id="1842" href="Codata.Musical.Costring.html#439" class="Function">Costring</a> <a id="1851" class="Symbol">→</a> <a id="1853" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="1856" href="Foreign.Haskell.html#295" class="Datatype">Unit</a>

  <a id="1864" class="Comment">-- Reads a finite file. Raises an exception if the file path refers</a>
  <a id="1934" class="Comment">-- to a non-physical file (like &quot;/dev/zero&quot;).</a>

  <a id="readFiniteFile"></a><a id="1983" href="IO.Primitive.html#1983" class="Postulate">readFiniteFile</a> <a id="1998" class="Symbol">:</a> <a id="2000" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="2007" class="Symbol">→</a> <a id="2009" href="Agda.Builtin.IO.html#70" class="Postulate">IO</a> <a id="2012" href="Agda.Builtin.String.html#165" class="Postulate">String</a>

<a id="2020" class="Symbol">{-#</a> <a id="2024" class="Keyword">FOREIGN</a> GHC
  readFiniteFile :: Data.Text.Text -&gt; IO Data.Text.Text
  readFiniteFile f = do
    h &lt;- System.IO.openFile (Data.Text.unpack f) System.IO.ReadMode
    Control.Exception.bracketOnError (return ()) (\_ -&gt; System.IO.hClose h)
                                                 (\_ -&gt; System.IO.hFileSize h)
    Data.Text.IO.hGetContents h

  fromColist :: MAlonzo.Code.Data.Colist.AgdaColist a -&gt; [a]
  fromColist MAlonzo.Code.Data.Colist.Nil         = []
  fromColist (MAlonzo.Code.Data.Colist.Cons x xs) =
    x : fromColist (MAlonzo.RTE.flat xs)

  toColist :: [a] -&gt; MAlonzo.Code.Data.Colist.AgdaColist a
  toColist []       = MAlonzo.Code.Data.Colist.Nil
  toColist (x : xs) =
    MAlonzo.Code.Data.Colist.Cons x (MAlonzo.RTE.Sharp (toColist xs))
<a id="2784" class="Symbol">#-}</a>

<a id="2789" class="Symbol">{-#</a> <a id="2793" class="Keyword">COMPILE</a> GHC <a id="2805" href="IO.Primitive.html#1640" class="Postulate">getContents</a>    = fmap toColist getContents                          <a id="2873" class="Symbol">#-}</a>
<a id="2877" class="Symbol">{-#</a> <a id="2881" class="Keyword">COMPILE</a> GHC <a id="2893" href="IO.Primitive.html#1668" class="Postulate">readFile</a>       = fmap toColist . readFile . Data.Text.unpack        <a id="2961" class="Symbol">#-}</a>
<a id="2965" class="Symbol">{-#</a> <a id="2969" class="Keyword">COMPILE</a> GHC <a id="2981" href="IO.Primitive.html#1705" class="Postulate">writeFile</a>      = \x -&gt; writeFile (Data.Text.unpack x) . fromColist  <a id="3049" class="Symbol">#-}</a>
<a id="3053" class="Symbol">{-#</a> <a id="3057" class="Keyword">COMPILE</a> GHC <a id="3069" href="IO.Primitive.html#1749" class="Postulate">appendFile</a>     = \x -&gt; appendFile (Data.Text.unpack x) . fromColist <a id="3137" class="Symbol">#-}</a>
<a id="3141" class="Symbol">{-#</a> <a id="3145" class="Keyword">COMPILE</a> GHC <a id="3157" href="IO.Primitive.html#1793" class="Postulate">putStr</a>         = putStr . fromColist                                <a id="3225" class="Symbol">#-}</a>
<a id="3229" class="Symbol">{-#</a> <a id="3233" class="Keyword">COMPILE</a> GHC <a id="3245" href="IO.Primitive.html#1828" class="Postulate">putStrLn</a>       = putStrLn . fromColist                              <a id="3313" class="Symbol">#-}</a>
<a id="3317" class="Symbol">{-#</a> <a id="3321" class="Keyword">COMPILE</a> GHC <a id="3333" href="IO.Primitive.html#1983" class="Postulate">readFiniteFile</a> = readFiniteFile                        <a id="3388" class="Symbol">#-}</a>
<a id="3392" class="Symbol">{-#</a> <a id="3396" class="Keyword">COMPILE</a> UHC <a id="3408" href="IO.Primitive.html#1640" class="Postulate">getContents</a>    = UHC.Agda.Builtins.primGetContents     <a id="3463" class="Symbol">#-}</a>
<a id="3467" class="Symbol">{-#</a> <a id="3471" class="Keyword">COMPILE</a> UHC <a id="3483" href="IO.Primitive.html#1668" class="Postulate">readFile</a>       = UHC.Agda.Builtins.primReadFile        <a id="3538" class="Symbol">#-}</a>
<a id="3542" class="Symbol">{-#</a> <a id="3546" class="Keyword">COMPILE</a> UHC <a id="3558" href="IO.Primitive.html#1705" class="Postulate">writeFile</a>      = UHC.Agda.Builtins.primWriteFile       <a id="3613" class="Symbol">#-}</a>
<a id="3617" class="Symbol">{-#</a> <a id="3621" class="Keyword">COMPILE</a> UHC <a id="3633" href="IO.Primitive.html#1749" class="Postulate">appendFile</a>     = UHC.Agda.Builtins.primAppendFile      <a id="3688" class="Symbol">#-}</a>
<a id="3692" class="Symbol">{-#</a> <a id="3696" class="Keyword">COMPILE</a> UHC <a id="3708" href="IO.Primitive.html#1793" class="Postulate">putStr</a>         = UHC.Agda.Builtins.primPutStr          <a id="3763" class="Symbol">#-}</a>
<a id="3767" class="Symbol">{-#</a> <a id="3771" class="Keyword">COMPILE</a> UHC <a id="3783" href="IO.Primitive.html#1828" class="Postulate">putStrLn</a>       = UHC.Agda.Builtins.primPutStrLn        <a id="3838" class="Symbol">#-}</a>
<a id="3842" class="Symbol">{-#</a> <a id="3846" class="Keyword">COMPILE</a> UHC <a id="3858" href="IO.Primitive.html#1983" class="Postulate">readFiniteFile</a> = UHC.Agda.Builtins.primReadFiniteFile  <a id="3913" class="Symbol">#-}</a>
</pre></body></html>